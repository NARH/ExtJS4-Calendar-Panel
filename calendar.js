/*
Copyright(c) 2011 NRT Engineer.
licensing@nrt-engineer.biz
*/
(function(){var c=this;if(typeof Nrt==="undefined"){c.Nrt={}}Nrt.global=c;var e=document.getElementsByTagName("script"),h=[/^localhost$/,/\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:\d{1,5})?\b/],l=window.location.hostname,b=false,a=window.location.search,k,m,f,j,d,g;for(f=0,j=e.length;f<j;f++){d=e[f].src;g=d.match(/bootstrap\.js$/);if(g){m=d.substring(0,d.length-g[0].length);break}}if(a.match("(\\?|&)debug")!==null){b=true}else{if(a.match("(\\?|&)nodebug")!==null){b=false}}if(b===null){for(f=0,j=h.length;f<j;f++){k=h[f];if(l.search(k)!==-1){b=true;break}}}if(b===null&&window.location.protocol==="file:"){b=true}Nrt.isDebug=b;Nrt.log=function(i){if(Nrt.isDebug&&!Ext.isIE){console.log(i)}}})();Ext.define("Nrt.calendar.view.Controllbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.nrt.calendar.controllbar",prependButtons:false,activeViewType:0,customDays:4,dateFormat:"m/d/Y",todayLabel:"tody",prevLabel:"next",nextLabel:"prev",dayViewLabel:"day view",weekViewLabel:"week view",monthViewLabel:"month view",customDaysViewLabel:"-days view",todoLabel:"todo list",currentDate:new Date(),getControllItems:function(){Nrt.log(" -- method getControllItems calling -- ");var b=this,a=b.customDays+b.customDaysViewLabel;return[{itemId:"today",text:b.todayLabel,tooltip:b.todayLabel,overflowText:b.todayLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-today",disabled:false,handler:b.moveToday,scope:b},"-",{itemId:"prev",tooltip:b.prevLabel,overflowText:b.prevLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-prev",disabled:false,handler:b.movePrev,scope:b},{itemId:"next",tooltip:b.nextLabel,overflowText:b.nextLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-next",disabled:false,handler:b.moveNext,scope:b},{itemId:"currentDate",html:Ext.Date.format(b.currentDate,b.dateFormat)},"->",{itemId:"dayView",text:b.dayViewLabel,tooltip:b.dayViewLabel,overflowText:b.dayViewLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-view-day",disabled:false,handler:b.moveDayView,scope:b},"-",{itemId:"weekView",text:b.weekViewLabel,tooltip:b.weekViewLabel,overflowText:b.weekViewLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-view-week",disabled:false,handler:b.moveWeekView,scope:b},"-",{itemId:"monthView",text:b.monthViewLabel,tooltip:b.monthViewLabel,overflowText:b.monthViewLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-view-month",disabled:false,handler:b.moveMonthView,scope:b},"-",{itemId:"customDaysView",text:a,tooltip:a,overflowText:a,iconCls:Ext.baseCSSPrefix+"tbar-calendar-view-customdays",disabled:false,handler:b.moveCustomDaysView,scope:b},"-",{itemId:"todoView",text:b.todoLabel,tooltip:b.todoLabel,overflowText:b.todoLabel,iconCls:Ext.baseCSSPrefix+"tbar-calendar-view-todo",disabled:false,handler:b.moveTodoView,scope:b}]},updateCurrentDate:function(a){Nrt.log(" -- method updateCurrentDate calling -- ");var b=this;b.currentDate=a;var d=Ext.Date.format(b.currentDate,b.dateFormat);var c=b.getComponent("currentDate").update(d);Nrt.log(" -- method updateCurrentDate done -- ")},initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var b=this,c=b.getControllItems(),a=b.items||b.buttons||[];if(b.prependButtons){b.items=a.concat(c)}else{b.items=c.concat(a)}delete b.buttons;b.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},moveToday:function(){Nrt.log(" -- today pushed -- ");this.updateCurrentDate(new Date())},movePrev:function(){Nrt.log(" -- prev pushed -- ");this.updateCurrentDate(Ext.Date.add(this.currentDate,Ext.Date.DAY,-1))},moveNext:function(){Nrt.log(" -- next pushed -- ");this.updateCurrentDate(Ext.Date.add(this.currentDate,Ext.Date.DAY,1))},moveDayView:function(){Nrt.log(" -- day view pushed -- ");this.getBubbleTarget().switchCard(this,"dayview")},moveWeekView:function(){Nrt.log(" -- week view pushed -- ");this.getBubbleTarget().switchCard(this,"weekview")},moveMonthView:function(){Nrt.log(" -- month view pushed -- ");this.getBubbleTarget().switchCard(this,"monthview")},moveCustomDaysView:function(){Nrt.log(" -- custom days view pushed -- ");this.getBubbleTarget().switchCard(this,"customview")},moveTodoView:function(){Nrt.log(" -- todo view pushed -- ");this.getBubbleTarget().switchCard(this,"todoview")}});Ext.define("Nrt.calendar.templates.AbstractViewTemplate",{extend:"Ext.XTemplate",template:[],constructor:function(){var b=this,a=this.template;if(Ext.isArray(arguments)){this.callParent(arguments.concat(a))}else{if(arguments.length>0){this.callParent(a.concat(arguments))}else{this.callParent(a)}}}});Ext.define("Nrt.calendar.view.AbstractView",{extend:"Ext.Component",tpl:false,initComponent:function(){Ext.log(" -- abstract component initilizing start -- "+this.alias);var a=this;Nrt.calendar.view.AbstractView.superclass.initComponent.call(this);a.addEvents();Ext.log(" -- abstract component initilizing done -- "+this.alias)},afterRender:function(){Ext.log(" -- abstract component afterRender start -- "+this.alias);Nrt.calendar.view.AbstractView.superclass.afterRender.call(this);Ext.log(" -- abstract component afterRender done -- "+this.alias)}});Ext.define("Nrt.calendar.templates.DayViewTemplate",{extend:"Nrt.calendar.templates.AbstractViewTemplate",template:['<table class="nrt-cal-bg-tbl" cellspacing="0" cellpadding="0">',"<tbody>",'<tr height="1">','<td class="nrt-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="nrt-cal-bg-rows">','<div class="nrt-cal-bg-rows-inner">','<tpl for="times">','<div class="nrt-cal-bg-row">','<div class="nrt-cal-bg-row-div ext-row-{#}"></div>',"</div>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="nrt-cal-day-times">','<tpl for="times">','<div class="nrt-cal-bg-row">','<div class="nrt-cal-day-time-inner">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="nrt-cal-day-col">','<div class="nrt-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="nrt-cal-day-col-gutter"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>"]});Ext.define("Nrt.calendar.view.DayView",{extend:"Nrt.calendar.view.AbstractView",alias:"widget.nrt.calendar.dayview",initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var a=this;a.html="ここは DayView";a.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},afterRender:function(){Nrt.log(" -- component afterRender start -- "+this.alias);if(!this.tpl){this.tpl=new Nrt.calendar.templates.DayViewTemplate({id:this.id})}this.tpl.compile();this.addClass("nrt-cal-body-ct");this.callParent();Nrt.log(" -- component afterRender done -- "+this.alias);this.today=Ext.Date.clearTime(new Date());this.dayCount=this.dayCount||1;var a=0,d=[],b=new Date(),c;for(;a<this.dayCount;a++){d[a]=Ext.Date.add(b,Ext.Date.DAY,a)}Nrt.log(" -- applyTemplate debug-1 -- "+d);c=[];b=Ext.Date.clearTime(new Date());for(a=0;a<24;a++){c.push(Ext.Date.format(b,"H:i"));b=Ext.Date.add(b,Ext.Date.HOUR,1)}Nrt.log(" -- applyTemplate debug-2 -- "+c);this.tpl.overwrite(this.el,{days:d,dayCount:d.length,times:c})}});Ext.define("Nrt.calendar.templates.WeekViewTemplate",{extend:"Nrt.calendar.templates.AbstractViewTemplate",template:["<div>","<div>{date}</div>","<div>{name}</div>","</div>"]});Ext.define("Nrt.calendar.view.WeekView",{extend:"Nrt.calendar.view.AbstractView",alias:"widget.nrt.calendar.weekview",initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var a=this;a.html="ここは WeekView";a.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},afterRender:function(){Nrt.log(" -- component afterRender start -- "+this.alias);if(!this.tpl){this.tpl=new Nrt.calendar.templates.WeekViewTemplate({id:this.id});this.tpl.compile()}this.callParent();Nrt.log(" -- component afterRender done -- "+this.alias);this.tpl.overwrite(this.el,{date:new Date(),name:this.alias})}});Ext.define("Nrt.calendar.templates.MonthViewTemplate",{extend:"Nrt.calendar.templates.AbstractViewTemplate",template:["<div>","<div>{date}</div>","<div>{name}</div>","</div>"]});Ext.define("Nrt.calendar.view.MonthView",{extend:"Nrt.calendar.view.AbstractView",alias:"widget.nrt.calendar.monthview",initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var a=this;a.html="ここは MonthView";a.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},afterRender:function(){Nrt.log(" -- component afterRender start -- "+this.alias);if(!this.tpl){this.tpl=new Nrt.calendar.templates.MonthViewTemplate({id:this.id});this.tpl.compile()}this.callParent();Nrt.log(" -- component afterRender done -- "+this.alias);this.tpl.overwrite(this.el,{date:new Date(),name:this.alias})}});Ext.define("Nrt.calendar.templates.CustomViewTemplate",{extend:"Nrt.calendar.templates.AbstractViewTemplate",template:["<div>","<div>{date}</div>","<div>{name}</div>","</div>"]});Ext.define("Nrt.calendar.view.CustomView",{extend:"Nrt.calendar.view.AbstractView",alias:"widget.nrt.calendar.customview",initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var a=this;a.html="ここは CustomView";a.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},afterRender:function(){Nrt.log(" -- component afterRender start -- "+this.alias);if(!this.tpl){this.tpl=new Nrt.calendar.templates.WeekViewTemplate({id:this.id});this.tpl.compile()}this.callParent();Nrt.log(" -- component afterRender done -- "+this.alias);this.tpl.overwrite(this.el,{date:new Date(),name:this.alias})}});Ext.define("Nrt.calendar.templates.TodoViewTemplate",{extend:"Nrt.calendar.templates.AbstractViewTemplate",template:["<div>","<div>{date}</div>","<div>{name}</div>","</div>"]});Ext.define("Nrt.calendar.view.TodoView",{extend:"Nrt.calendar.view.AbstractView",alias:"widget.nrt.calendar.todoview",initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var a=this;a.html="ここは TodoView";a.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},afterRender:function(){Nrt.log(" -- component afterRender start -- "+this.alias);if(!this.tpl){this.tpl=new Nrt.calendar.templates.TodoViewTemplate({id:this.id});this.tpl.compile()}this.callParent();Nrt.log(" -- component afterRender done -- "+this.alias);this.tpl.overwrite(this.el,{date:new Date(),name:this.alias})}});Ext.define("Nrt.calendar.view.AbstractPanel",{extend:"Ext.panel.Panel"});Ext.define("Nrt.calendar.view.Panel",{extend:"Nrt.calendar.view.AbstractPanel",alias:"widget.nrt.calendar",layout:"card",autoScroll:true,dockedItems:[{xtype:"nrt.calendar.controll",dock:"top"}],items:[{itemId:"dayview",xtype:"nrt.calendar.dayview"},{itemId:"weekview",xtype:"nrt.calendar.weekview"},{itemId:"monthview",xtype:"nrt.calendar.monthview"},{itemId:"customview",xtype:"nrt.calendar.customview"},{itemId:"todoview",xtype:"nrt.calendar.todoview"}],initComponent:function(){Nrt.log(" -- component initilizing start -- "+this.alias);var a=this;Ext.apply("Nrt.calendar.Panel",{});a.callParent();Nrt.log(" -- component initilizing done -- "+this.alias)},listeners:{},switchCard:function(a,c){Nrt.log(" -- day view bubble -- "+c);var b=this.getLayout().setActiveItem(c)}});
